# 实验源程序
# 原始版本
DATAS SEGMENT
   X DB 128,168,203,232,250,255,250,232,203,168,128,88,53,24,6,0,6,24,53,88
   XXY DB "type in 1:square wave;type in 2:sine wave;type in 3:triangular wave;type in 4:sawtooth wave" ,0AH,0DH,'$'
   DATAS ENDS
 
STACKS SEGMENT
       DB 100 DUP(?)
STACKS ENDS
 
CODES SEGMENT
    ASSUME CS:CODES,DS:DATAS,SS:STACKS
MAIN PROC
    MOV AX,DATAS
    MOV DS,AX
    MOV AH,09H
    MOV DX,OFFSET XXY
    INT 21H
 
BACK:MOV AH,01H
     INT 21H
    CMP AL,31H
    JE SQUWAV
    CMP AL,32H
    JE SINWAV
    CMP AL,33H
    JE TRANWAV
    CMP AL,34H
    JE SAWWAV
    JMP BACK
 
SQUWAV: CALL SQU
SINWAV: CALL SIN
TRANWAV:CALL TRAN
SAWWAV:CALL SAW
EXIT: MOV AH, 4CH
     INT 21H
   MAIN ENDP
 
SQU PROC ;
AGAIN1:  
MOV AL,0FFH
    MOV DX,290H
    OUT DX,AL
    CALL DELAY
    MOV AL,0
    OUT DX,AL
    CALL DELAY
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ AGAIN1
    JMP EXIT
    RET
SQU ENDP
 
SIN PROC;
AGAIN2:
    MOV CX,20
    MOV SI,OFFSET X
NEXT:
    MOV AL,[SI]
    MOV DX,290H
    OUT DX,AL
    INC SI
    LOOP NEXT
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ AGAIN2
    JMP EXIT
    RET
SIN ENDP
 
TRAN PROC;
BEGIN1:
MOV AL ,1AH
    MOV DX, 290H
UP: 
OUT DX,AL
    INC AL
    CMP AL, 0FFH
    JNZ UP
    DEC AL
DOWN:
OUT DX,AL
    DEC AL
    CMP AL,0
    JNZ DOWN
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ BEGIN1
    JMP EXIT
    RET
TRAN ENDP
 
SAW PROC;
BEGIN2:
MOV AL, 0H
    MOV DX, 290H
UP1:
OUT DX,AL
    INC AL
    CMP AL, 0FFH
    JNZ UP1
    JMP BEGIN2
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ BEGIN2
    JMP EXIT
    RET
SAW ENDP
 
DELAY PROC;
    MOV BL,7
AGAIN:
    MOV CX,0
LOOPS:
    LOOP LOOPS
    DEC BL
    JNZ AGAIN
    RET
DELAY ENDP
 
CODES ENDS
    END MAIN


# 修改版本
SQUWAV: CALL SQU
JMP EXIT
SINWAV: CALL SIN
JMP EXIT
TRANWAV:CALL TRAN
JMP EXIT
SAWWAV:CALL SAW
EXIT: MOV AH, 4CH
     INT 21H
   MAIN ENDP
 
SQU PROC ;
AGAIN1:  
MOV AL,0FFH
    MOV DX,290H
    OUT DX,AL
    CALL DELAY
    MOV AL,0
    OUT DX,AL
    CALL DELAY
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ AGAIN1
    JMP EXIT
    RET
SQU ENDP
 
SIN PROC;
AGAIN2:
    MOV CX,20
    MOV SI,OFFSET X
NEXT:
    MOV AL,[SI]
    MOV DX,290H
    OUT DX,AL
    INC SI
    LOOP NEXT
    MOV AH,6
    MOV DL,0FFH
    INT 21H
    JZ AGAIN2
    RET
SIN ENDP