# 实验源程序
# 原始版本
APORT EQU 288H
CPORT EQU 28AH
CTRLPORT EQU 28BH
DATAS SEGMENT
    TABLE1 DB 3FH,06H,5BH,4FH,66H,6DH,7DH,07H,7FH,6FH
    P1 DB 20 DUP(?)       
DATAS ENDS

STACKS SEGMENT
    PS DB 20 DUP(?)
    TOP EQU LENGTH PS
STACKS ENDS

CODES SEGMENT
    ASSUME CS:CODES,DS:DATAS,SS:STACKS
MAIN PROC
    MOV AX,DATAS
    MOV DS,AX
    MOV AX,STACKS
    MOV SS,AX
    MOV SP,TOP
    MOV AX,OFFSET P1
    MOV SI,AX
    XOR AX,AX
    XOR BX,BX
    XOR DX,DX
INPUT:CALL KEYIN
    AND AL,0FH
    MOV [SI],AL
    INC SI
CALL KEYIN
    AND AL,0FH
    MOV [SI],AL
    MOV AX,OFFSET P1
    MOV SI,AX
    XOR AX,AX
    MOV BX,OFFSET TABLE1
    XOR DX,DX
    MOV CX,2
CHANGE1:
    MOV AL,[SI]
    XLAT
    MOV [SI],AL
    INC SI
    LOOP CHANGE1
    MOV AX,OFFSET P1
    MOV SI,AX
    XOR AX,AX
    XOR BX,BX
    XOR CX,CX
    XOR DX,DX
SHOW:
    MOV AL,10000010B;
    MOV DX,CTRLPORT    
    OUT DX,AL
NUM1:    
    MOV AL,[SI]
    MOV DX,APORT
    OUT DX,AL
    MOV AL,01H
    MOV DX,CPORT
    OUT DX,AL
    MOV CX,0FFFFH
DELAY1:LOOP DELAY1
    MOV CX,0FFFFH
DELAY2:LOOP DELAY2
    INC SI      
NUM2:
    MOV AL,[SI]
    MOV DX,APORT
    OUT DX,AL
    MOV AL,02H
    MOV DX,CPORT
    OUT DX,AL
    MOV CX,0FFFFH
DELAY4:LOOP DELAY4
    MOV CX,0FFFFH
DELAY3:LOOP DELAY3
    DEC SI
JU:
    MOV AH,06H
    MOV DL,0FFH
    INT 21H
    SUB AL,20H
    JNZ NUM1
EXC:
    MOV AH,4CH
    INT 21H
MAIN ENDP
        
KEYIN  PROC 
AGAIN:MOV AH,8
      INT 21H
      CMP AL,30H
      JB AGAIN
      CMP AL,39H
      JA AGAIN
      MOV DL,AL
      MOV AH,2
      INT 21H
      RET
KEYIN ENDP
        
CODES ENDS
    END MAIN


# 修改版本
MAIN PROC
    MOV AX,DATAS
    MOV DS,AX
    MOV AX,STACKS
    MOV SS,AX
    MOV SP,TOP
    MOV SI,OFFSET P1
INPUT:CALL KEYIN
    AND AL,0FH
    MOV [SI],AL
    INC SI
CALL KEYIN
    AND AL,0FH
    MOV [SI],AL
    MOV SI,OFFSET P1
    MOV BX,OFFSET TABLE1
    MOV CX,2
CHANGE1:
    MOV AL,[SI]
    XLAT
    MOV [SI],AL
    INC SI
    LOOP CHANGE1
    MOV SI,OFFSET P1
SHOW:
    MOV AL,10000010B;
    MOV DX,CTRLPORT    
    OUT DX,AL
NUM1:    
    MOV AL,[SI]
    MOV DX,APORT
    OUT DX,AL
    MOV AL,01H
    MOV DX,CPORT
    OUT DX,AL
    MOV CX,0FFFFH
DELAY1:LOOP DELAY1
    MOV CX,0FFFFH
DELAY2:LOOP DELAY2
    INC SI      
NUM2:
    MOV AL,[SI]
    MOV DX,APORT
    OUT DX,AL
    MOV AL,02H
    MOV DX,CPORT
    OUT DX,AL
    MOV CX,0FFFFH
DELAY4:LOOP DELAY4
    MOV CX,0FFFFH
DELAY3:LOOP DELAY3
    DEC SI
JU:
    MOV AH,06H
    MOV DL,0FFH
    INT 21H
    SUB AL,20H
    JNZ NUM1
EXC:
    MOV AH,4CH
    INT 21H
MAIN ENDP